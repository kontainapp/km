/*
 * Copyright Â© 2018-2019 Kontain Inc. All rights reserved.
 *
 * Kontain Inc CONFIDENTIAL
 *
 * This file includes unpublished proprietary source code of Kontain Inc. The
 * copyright notice above does not evidence any actual or intended publication
 * of such source code. Disclosure of this source code or any related
 * proprietary information is strictly prohibited without the express written
 * permission of Kontain Inc.
 *
 * Mapping hc/syscal id to name - mainly debug/trace helper
 */
#include "km_hcalls.h"

static const char* hc_name[KM_MAX_HCALL] = {0};

static int inited = 0;
static void km_hc_name_init(void)
{
   hc_name[0] = "read";
   hc_name[1] = "write";
   hc_name[2] = "open";
   hc_name[3] = "close";
   hc_name[4] = "stat";
   hc_name[5] = "fstat";
   hc_name[6] = "lstat";
   hc_name[7] = "poll";
   hc_name[8] = "lseek";
   hc_name[9] = "mmap";
   hc_name[10] = "mprotect";
   hc_name[11] = "munmap";
   hc_name[12] = "brk";
   hc_name[13] = "rt_sigaction";
   hc_name[14] = "rt_sigprocmask";
   hc_name[15] = "rt_sigreturn";
   hc_name[16] = "ioctl";
   hc_name[17] = "pread64";
   hc_name[18] = "pwrite64";
   hc_name[19] = "readv";
   hc_name[20] = "writev";
   hc_name[21] = "access";
   hc_name[22] = "pipe";
   hc_name[23] = "select";
   hc_name[24] = "sched_yield";
   hc_name[25] = "mremap";
   hc_name[26] = "msync";
   hc_name[27] = "mincore";
   hc_name[28] = "madvise";
   hc_name[29] = "shmget";
   hc_name[30] = "shmat";
   hc_name[31] = "shmctl";
   hc_name[32] = "dup";
   hc_name[33] = "dup2";
   hc_name[34] = "pause";
   hc_name[35] = "nanosleep";
   hc_name[36] = "getitimer";
   hc_name[37] = "alarm";
   hc_name[38] = "setitimer";
   hc_name[39] = "getpid";
   hc_name[40] = "sendfile";
   hc_name[41] = "socket";
   hc_name[42] = "connect";
   hc_name[43] = "accept";
   hc_name[44] = "sendto";
   hc_name[45] = "recvfrom";
   hc_name[46] = "sendmsg";
   hc_name[47] = "recvmsg";
   hc_name[48] = "shutdown";
   hc_name[49] = "bind";
   hc_name[50] = "listen";
   hc_name[51] = "getsockname";
   hc_name[52] = "getpeername";
   hc_name[53] = "socketpair";
   hc_name[54] = "setsockopt";
   hc_name[55] = "getsockopt";
   hc_name[56] = "clone";
   hc_name[57] = "fork";
   hc_name[58] = "vfork";
   hc_name[59] = "execve";
   hc_name[60] = "exit";
   hc_name[61] = "wait4";
   hc_name[62] = "kill";
   hc_name[63] = "uname";
   hc_name[64] = "semget";
   hc_name[65] = "semop";
   hc_name[66] = "semctl";
   hc_name[67] = "shmdt";
   hc_name[68] = "msgget";
   hc_name[69] = "msgsnd";
   hc_name[70] = "msgrcv";
   hc_name[71] = "msgctl";
   hc_name[72] = "fcntl";
   hc_name[73] = "flock";
   hc_name[74] = "fsync";
   hc_name[75] = "fdatasync";
   hc_name[76] = "truncate";
   hc_name[77] = "ftruncate";
   hc_name[78] = "getdents";
   hc_name[79] = "getcwd";
   hc_name[80] = "chdir";
   hc_name[81] = "fchdir";
   hc_name[82] = "rename";
   hc_name[83] = "mkdir";
   hc_name[84] = "rmdir";
   hc_name[85] = "creat";
   hc_name[86] = "link";
   hc_name[87] = "unlink";
   hc_name[88] = "symlink";
   hc_name[89] = "readlink";
   hc_name[90] = "chmod";
   hc_name[91] = "fchmod";
   hc_name[92] = "chown";
   hc_name[93] = "fchown";
   hc_name[94] = "lchown";
   hc_name[95] = "umask";
   hc_name[96] = "gettimeofday";
   hc_name[97] = "getrlimit";
   hc_name[98] = "getrusage";
   hc_name[99] = "sysinfo";
   hc_name[100] = "times";
   hc_name[101] = "ptrace";
   hc_name[102] = "getuid";
   hc_name[103] = "syslog";
   hc_name[104] = "getgid";
   hc_name[105] = "setuid";
   hc_name[106] = "setgid";
   hc_name[107] = "geteuid";
   hc_name[108] = "getegid";
   hc_name[109] = "setpgid";
   hc_name[110] = "getppid";
   hc_name[111] = "getpgrp";
   hc_name[112] = "setsid";
   hc_name[113] = "setreuid";
   hc_name[114] = "setregid";
   hc_name[115] = "getgroups";
   hc_name[116] = "setgroups";
   hc_name[117] = "setresuid";
   hc_name[118] = "getresuid";
   hc_name[119] = "setresgid";
   hc_name[120] = "getresgid";
   hc_name[121] = "getpgid";
   hc_name[122] = "setfsuid";
   hc_name[123] = "setfsgid";
   hc_name[124] = "getsid";
   hc_name[125] = "capget";
   hc_name[126] = "capset";
   hc_name[127] = "rt_sigpending";
   hc_name[128] = "rt_sigtimedwait";
   hc_name[129] = "rt_sigqueueinfo";
   hc_name[130] = "rt_sigsuspend";
   hc_name[131] = "sigaltstack";
   hc_name[132] = "utime";
   hc_name[133] = "mknod";
   hc_name[134] = "uselib";
   hc_name[135] = "personality";
   hc_name[136] = "ustat";
   hc_name[137] = "statfs";
   hc_name[138] = "fstatfs";
   hc_name[139] = "sysfs";
   hc_name[140] = "getpriority";
   hc_name[141] = "setpriority";
   hc_name[142] = "sched_setparam";
   hc_name[143] = "sched_getparam";
   hc_name[144] = "sched_setscheduler";
   hc_name[145] = "sched_getscheduler";
   hc_name[146] = "sched_get_priority_max";
   hc_name[147] = "sched_get_priority_min";
   hc_name[148] = "sched_rr_get_interval";
   hc_name[149] = "mlock";
   hc_name[150] = "munlock";
   hc_name[151] = "mlockall";
   hc_name[152] = "munlockall";
   hc_name[153] = "vhangup";
   hc_name[154] = "modify_ldt";
   hc_name[155] = "pivot_root";
   hc_name[156] = "_sysctl";
   hc_name[157] = "prctl";
   hc_name[158] = "arch_prctl";
   hc_name[159] = "adjtimex";
   hc_name[160] = "setrlimit";
   hc_name[161] = "chroot";
   hc_name[162] = "sync";
   hc_name[163] = "acct";
   hc_name[164] = "settimeofday";
   hc_name[165] = "mount";
   hc_name[166] = "umount2";
   hc_name[167] = "swapon";
   hc_name[168] = "swapoff";
   hc_name[169] = "reboot";
   hc_name[170] = "sethostname";
   hc_name[171] = "setdomainname";
   hc_name[172] = "iopl";
   hc_name[173] = "ioperm";
   hc_name[174] = "create_module";
   hc_name[175] = "init_module";
   hc_name[176] = "delete_module";
   hc_name[177] = "get_kernel_syms";
   hc_name[178] = "query_module";
   hc_name[179] = "quotactl";
   hc_name[180] = "nfsservctl";
   hc_name[181] = "getpmsg";
   hc_name[182] = "putpmsg";
   hc_name[183] = "afs_syscall";
   hc_name[184] = "tuxcall";
   hc_name[185] = "security";
   hc_name[186] = "gettid";
   hc_name[187] = "readahead";
   hc_name[188] = "setxattr";
   hc_name[189] = "lsetxattr";
   hc_name[190] = "fsetxattr";
   hc_name[191] = "getxattr";
   hc_name[192] = "lgetxattr";
   hc_name[193] = "fgetxattr";
   hc_name[194] = "listxattr";
   hc_name[195] = "llistxattr";
   hc_name[196] = "flistxattr";
   hc_name[197] = "removexattr";
   hc_name[198] = "lremovexattr";
   hc_name[199] = "fremovexattr";
   hc_name[200] = "tkill";
   hc_name[201] = "time";
   hc_name[202] = "futex";
   hc_name[203] = "sched_setaffinity";
   hc_name[204] = "sched_getaffinity";
   hc_name[205] = "set_thread_area";
   hc_name[206] = "io_setup";
   hc_name[207] = "io_destroy";
   hc_name[208] = "io_getevents";
   hc_name[209] = "io_submit";
   hc_name[210] = "io_cancel";
   hc_name[211] = "get_thread_area";
   hc_name[212] = "lookup_dcookie";
   hc_name[213] = "epoll_create";
   hc_name[214] = "epoll_ctl_old";
   hc_name[215] = "epoll_wait_old";
   hc_name[216] = "remap_file_pages";
   hc_name[217] = "getdents64";
   hc_name[218] = "set_tid_address";
   hc_name[219] = "restart_syscall";
   hc_name[220] = "semtimedop";
   hc_name[221] = "fadvise64";
   hc_name[222] = "timer_create";
   hc_name[223] = "timer_settime";
   hc_name[224] = "timer_gettime";
   hc_name[225] = "timer_getoverrun";
   hc_name[226] = "timer_delete";
   hc_name[227] = "clock_settime";
   hc_name[228] = "clock_gettime";
   hc_name[229] = "clock_getres";
   hc_name[230] = "clock_nanosleep";
   hc_name[231] = "exit_group";
   hc_name[232] = "epoll_wait";
   hc_name[233] = "epoll_ctl";
   hc_name[234] = "tgkill";
   hc_name[235] = "utimes";
   hc_name[236] = "vserver";
   hc_name[237] = "mbind";
   hc_name[238] = "set_mempolicy";
   hc_name[239] = "get_mempolicy";
   hc_name[240] = "mq_open";
   hc_name[241] = "mq_unlink";
   hc_name[242] = "mq_timedsend";
   hc_name[243] = "mq_timedreceive";
   hc_name[244] = "mq_notify";
   hc_name[245] = "mq_getsetattr";
   hc_name[246] = "kexec_load";
   hc_name[247] = "waitid";
   hc_name[248] = "add_key";
   hc_name[249] = "request_key";
   hc_name[250] = "keyctl";
   hc_name[251] = "ioprio_set";
   hc_name[252] = "ioprio_get";
   hc_name[253] = "inotify_init";
   hc_name[254] = "inotify_add_watch";
   hc_name[255] = "inotify_rm_watch";
   hc_name[256] = "migrate_pages";
   hc_name[257] = "openat";
   hc_name[258] = "mkdirat";
   hc_name[259] = "mknodat";
   hc_name[260] = "fchownat";
   hc_name[261] = "futimesat";
   hc_name[262] = "newfstatat";
   hc_name[263] = "unlinkat";
   hc_name[264] = "renameat";
   hc_name[265] = "linkat";
   hc_name[266] = "symlinkat";
   hc_name[267] = "readlinkat";
   hc_name[268] = "fchmodat";
   hc_name[269] = "faccessat";
   hc_name[270] = "pselect6";
   hc_name[271] = "ppoll";
   hc_name[272] = "unshare";
   hc_name[273] = "set_robust_list";
   hc_name[274] = "get_robust_list";
   hc_name[275] = "splice";
   hc_name[276] = "tee";
   hc_name[277] = "sync_file_range";
   hc_name[278] = "vmsplice";
   hc_name[279] = "move_pages";
   hc_name[280] = "utimensat";
   hc_name[281] = "epoll_pwait";
   hc_name[282] = "signalfd";
   hc_name[283] = "timerfd_create";
   hc_name[284] = "eventfd";
   hc_name[285] = "fallocate";
   hc_name[286] = "timerfd_settime";
   hc_name[287] = "timerfd_gettime";
   hc_name[288] = "accept4";
   hc_name[289] = "signalfd4";
   hc_name[290] = "eventfd2";
   hc_name[291] = "epoll_create1";
   hc_name[292] = "dup3";
   hc_name[293] = "pipe2";
   hc_name[294] = "inotify_init1";
   hc_name[295] = "preadv";
   hc_name[296] = "pwritev";
   hc_name[297] = "rt_tgsigqueueinfo";
   hc_name[298] = "perf_event_open";
   hc_name[299] = "recvmmsg";
   hc_name[300] = "fanotify_init";
   hc_name[301] = "fanotify_mark";
   hc_name[302] = "prlimit64";
   hc_name[303] = "name_to_handle_at";
   hc_name[304] = "open_by_handle_at";
   hc_name[305] = "clock_adjtime";
   hc_name[306] = "syncfs";
   hc_name[307] = "sendmmsg";
   hc_name[308] = "setns";
   hc_name[309] = "getcpu";
   hc_name[310] = "process_vm_readv";
   hc_name[311] = "process_vm_writev";
   hc_name[312] = "kcmp";
   hc_name[313] = "finit_module";
   hc_name[314] = "sched_setattr";
   hc_name[315] = "sched_getattr";
   hc_name[316] = "renameat2";
   hc_name[317] = "seccomp";
   hc_name[318] = "getrandom";
   hc_name[319] = "memfd_create";
   hc_name[320] = "kexec_file_load";
   hc_name[321] = "bpf";
   hc_name[322] = "execveat";
   hc_name[323] = "userfaultfd";
   hc_name[324] = "membarrier";
   hc_name[325] = "mlock2";
   hc_name[326] = "copy_file_range";
   hc_name[327] = "preadv2";
   hc_name[328] = "pwritev2";
   hc_name[329] = "pkey_mprotect";
   hc_name[330] = "pkey_alloc";
   hc_name[331] = "pkey_free";
   hc_name[332] = "statx";
   hc_name[333] = "io_pgetevents";
   hc_name[334] = "rseq";
   hc_name[424] = "pidfd_send_signal";
   hc_name[425] = "io_uring_setup";
   hc_name[426] = "io_uring_enter";
   hc_name[427] = "io_uring_register";
   hc_name[428] = "open_tree";
   hc_name[429] = "move_mount";
   hc_name[430] = "fsopen";
   hc_name[431] = "fsconfig";
   hc_name[432] = "fsmount";
   hc_name[433] = "fspick";
   hc_name[HC_unmapself] = "unmapself";
   hc_name[HC_reserved3] = "reserved3";
   hc_name[HC_reserved4] = "reserved4";
   hc_name[HC_guest_interrupt] = "guest_interrupt";
}

const char* const km_hc_name_get(int hc)
{
   if (inited == 0) {
      km_hc_name_init();
      inited = 1;   // no need to lock, worst case competing threads will call it extra time(s)
   }
   if (hc >= sizeof(hc_name) / sizeof(hc_name[0]) || hc_name[hc] == 0) {
      return "n/a";
   }
   return hc_name[hc];
}
