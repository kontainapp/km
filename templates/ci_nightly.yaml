# Contains:
# 1. All the long running tests and tests that run in normal CI.
# 2. All the validation the requires a refresh k8s cluster.

steps:
  - bash: make -C tests test-all-withk8s
    displayName: KM tests - run on Kubernetes
    timeoutInMinutes: 15

  - bash: make -C tests coverage-withk8s
    displayName: KM tests with coverage - run on Kubernetes
    timeoutInMinutes: 15

  - bash: make -C payloads/python test-all-withk8s
    displayName: Python.km tests - run on Kubernetes
    timeoutInMinutes: 15

  - bash: make -C payloads/node test-all-withk8s
    displayName: Node.km tests - run on Kubernetes
    timeoutInMinutes: 30

  - bash: make -C payloads validate-runenv-withk8s
    displayName: payloads runenv validation - run on Kubernetes
    timeoutInMinutes: 5

  - bash: make edge-release GITHUB_RELEASE_TOKEN=$(GITHUB_RELEASE_TOKEN)
    displayName: Refresh release v0.1-edge
    timeoutInMinutes: 5