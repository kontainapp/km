# Put all the setup steps here. This file is designed to be shared by different
# pipelines.

steps:
  - checkout: self
    submodules: true

  - bash: |
      echo ====Environment info===
      echo "SHA: $(git rev-parse HEAD)"
      echo "=== Last 10 commits:"
      git log -n 10 --graph --pretty=format:'%h% %d %s %cr %ce'
      echo "=== VM/OS:"
      cat /proc/version
      echo "=== Docker version:"
      docker version
      echo ==== Environment Variables
      env
      echo ==== CPU Info
      lscpu
    displayName: Print build environment info

  - bash: make -C cloud/azure login-cli
      SP_APPID=$(SP_appId) SP_PASSWORD=$(SP_password) SP_TENANT=$(SP_tenant) SP_DISPLAYNAME=$(SP_displayName)
    displayName: Login to Azure, container registry and Kubernetes
